dynamic-etl/
│
├── package.json
├── README.md
├── .gitignore
├── docker-compose.yml
│
└── src/
    ├── server.js
    ├── router.js
    │
    ├── ingestion/
    │   ├── extractText.js
    │   ├── extractPDF.js
    │   ├── extractMarkdown.js
    │   └── extractTXT.js
    │
    ├── pipeline/
    │   ├── detectBlocks.js
    │   ├── parseBlocks.js
    │   ├── generateSchema.js
    │   ├── diffSchema.js
    │   ├── normalizeRecord.js
    │   ├── summarizeFragments.js
    │   ├── blockTypes/
    │   │   ├── detectCSV.js
    │   │   ├── detectHTML.js
    │   │   ├── detectJSON.js
    │   │   ├── detectKV.js
    │   │   ├── detectCodeBlocks.js
    │   │   └── detectYAML.js
    │   │
    │   └── parsers/
    │       ├── parseCSV.js
    │       ├── parseHTML.js
    │       ├── parseJSON.js
    │       ├── parseKV.js
    │       ├── parseYAML.js
    │       └── parseRaw.js
    │
    ├── db/
    │   ├── mongo.js
    │   ├── schemaStore.js
    │   ├── ingestionStore.js
    │   ├── recordStore.js
    │   └── migrations/
    │       └── migrationEngine.js
    │
    ├── api/
    │   ├── uploadHandler.js
    │   ├── schemaHandler.js
    │   ├── recordsHandler.js
    │   ├── queryHandler.js
    │   └── healthHandler.js
    │
    ├── util/
    │   ├── logger.js
    │   ├── textClean.js
    │   ├── idGenerator.js
    │   ├── detectType.js
    │   ├── validateInput.js
    │   └── safeJSON.js
    │
    ├── llm/
    │   ├── nlToMongo.js
    │   ├── nlToSQL.js
    │   ├── prompts/
    │   │   ├── mongoPrompt.txt
    │   │   └── sqlPrompt.txt
    │   ├── mockLLM.js   # for CI testing
    │   └── llmProvider.js
    │
    └── test/
        ├── samples/
        │   ├── tierA/
        │   ├── tierB/
        │   ├── tierC/
        │   └── tierD/
        ├── integration/
        │   ├── upload.test.js
        │   ├── schema.test.js
        │   ├── evolution.test.js
        │   └── queryFlow.test.js
        └── utils/
            └── mockUpload.js




/**
 * Extract raw UTF-8 text from .txt file.
 */
module.exports = function extractTXT(buffer) {
  try {
    return buffer.toString("utf8");
  } catch (err) {
    console.error("TXT extraction failed:", err);
    return "";
  }
};


/**
 * Extract text from Markdown file.
 * We simply decode the buffer — parsing happens later in the pipeline.
 */
module.exports = function extractMarkdown(buffer) {
  try {
    return buffer.toString("utf8");
  } catch (err) {
    console.error("Markdown extraction failed:", err);
    return "";
  }
}; 